{"ast":null,"code":"import { StorageAction } from '@aws-amplify/core/internals/utils';\nimport '@smithy/md5-js';\nimport '@aws-amplify/core/internals/aws-client-utils';\nimport '../../utils/client/runtime/s3TransferHandler/fetch.mjs';\nimport 'fast-xml-parser';\nimport '../../utils/client/runtime/s3TransferHandler/xhr.mjs';\nimport 'buffer';\nimport { resolveS3ConfigAndInput } from '../../utils/resolveS3ConfigAndInput.mjs';\nimport '../../../../errors/types/validation.mjs';\nimport { logger } from '../../../../utils/logger.mjs';\nimport '../../utils/client/base.mjs';\nimport '../../utils/client/getObject.mjs';\nimport { listObjectsV2 } from '../../utils/client/listObjectsV2.mjs';\nimport '../../utils/client/putObject.mjs';\nimport '../../utils/client/createMultipartUpload.mjs';\nimport '../../utils/client/uploadPart.mjs';\nimport '../../utils/client/completeMultipartUpload.mjs';\nimport '../../utils/client/listParts.mjs';\nimport '../../utils/client/abortMultipartUpload.mjs';\nimport '../../utils/client/copyObject.mjs';\nimport '../../utils/client/headObject.mjs';\nimport '../../utils/client/deleteObject.mjs';\nimport { getStorageUserAgentValue } from '../../utils/userAgent.mjs';\n\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nconst MAX_PAGE_SIZE = 1000;\nconst list = async (amplify, input) => {\n  const {\n    options = {},\n    prefix: path = ''\n  } = input !== null && input !== void 0 ? input : {};\n  const {\n    s3Config,\n    bucket,\n    keyPrefix: prefix\n  } = await resolveS3ConfigAndInput(amplify, options);\n  // @ts-expect-error pageSize and nextToken should not coexist with listAll\n  if (options !== null && options !== void 0 && options.listAll && (options !== null && options !== void 0 && options.pageSize || options !== null && options !== void 0 && options.nextToken)) {\n    const anyOptions = options;\n    logger.debug(\"listAll is set to true, ignoring \".concat(anyOptions !== null && anyOptions !== void 0 && anyOptions.pageSize ? \"pageSize: \".concat(anyOptions === null || anyOptions === void 0 ? void 0 : anyOptions.pageSize) : '', \" \").concat(anyOptions !== null && anyOptions !== void 0 && anyOptions.nextToken ? \"nextToken: \".concat(anyOptions === null || anyOptions === void 0 ? void 0 : anyOptions.nextToken) : '', \".\"));\n  }\n  const listParams = {\n    Bucket: bucket,\n    Prefix: \"\".concat(prefix).concat(path),\n    MaxKeys: options !== null && options !== void 0 && options.listAll ? undefined : options === null || options === void 0 ? void 0 : options.pageSize,\n    ContinuationToken: options !== null && options !== void 0 && options.listAll ? undefined : options === null || options === void 0 ? void 0 : options.nextToken\n  };\n  logger.debug(\"listing items from \\\"\".concat(listParams.Prefix, \"\\\"\"));\n  return options.listAll ? _listAll({\n    s3Config,\n    listParams,\n    prefix\n  }) : _list({\n    s3Config,\n    listParams,\n    prefix\n  });\n};\nconst _listAll = async _ref => {\n  let {\n    s3Config,\n    listParams,\n    prefix\n  } = _ref;\n  const listResult = [];\n  let continuationToken = listParams.ContinuationToken;\n  do {\n    const {\n      items: pageResults,\n      nextToken: pageNextToken\n    } = await _list({\n      prefix,\n      s3Config,\n      listParams: {\n        ...listParams,\n        ContinuationToken: continuationToken,\n        MaxKeys: MAX_PAGE_SIZE\n      }\n    });\n    listResult.push(...pageResults);\n    continuationToken = pageNextToken;\n  } while (continuationToken);\n  return {\n    items: listResult\n  };\n};\nconst _list = async _ref2 => {\n  let {\n    s3Config,\n    listParams,\n    prefix\n  } = _ref2;\n  const listParamsClone = {\n    ...listParams\n  };\n  if (!listParamsClone.MaxKeys || listParamsClone.MaxKeys > MAX_PAGE_SIZE) {\n    logger.debug(\"defaulting pageSize to \".concat(MAX_PAGE_SIZE, \".\"));\n    listParamsClone.MaxKeys = MAX_PAGE_SIZE;\n  }\n  const response = await listObjectsV2({\n    ...s3Config,\n    userAgentValue: getStorageUserAgentValue(StorageAction.List)\n  }, listParamsClone);\n  if (!(response !== null && response !== void 0 && response.Contents)) {\n    return {\n      items: []\n    };\n  }\n  const listResult = response.Contents.map(item => ({\n    key: item.Key.substring(prefix.length),\n    eTag: item.ETag,\n    lastModified: item.LastModified,\n    size: item.Size\n  }));\n  return {\n    items: listResult,\n    nextToken: response.NextContinuationToken\n  };\n};\nexport { list };","map":{"version":3,"names":["MAX_PAGE_SIZE","list","amplify","input","options","prefix","path","s3Config","bucket","keyPrefix","resolveS3ConfigAndInput","listAll","pageSize","nextToken","anyOptions","logger","debug","concat","listParams","Bucket","Prefix","MaxKeys","undefined","ContinuationToken","_listAll","_list","_ref","listResult","continuationToken","items","pageResults","pageNextToken","push","_ref2","listParamsClone","response","listObjectsV2","userAgentValue","getStorageUserAgentValue","StorageAction","List","Contents","map","item","key","Key","substring","length","eTag","ETag","lastModified","LastModified","size","Size","NextContinuationToken"],"sources":["/Users/raphaperso/Documents/Hub/amplify_test/notes/node_modules/@aws-amplify/storage/src/providers/s3/apis/internal/list.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { StorageAction } from '@aws-amplify/core/internals/utils';\nimport { resolveS3ConfigAndInput } from '../../utils';\nimport { listObjectsV2, } from '../../utils/client';\nimport { getStorageUserAgentValue } from '../../utils/userAgent';\nimport { logger } from '../../../../utils';\nconst MAX_PAGE_SIZE = 1000;\nexport const list = async (amplify, input) => {\n    const { options = {}, prefix: path = '' } = input ?? {};\n    const { s3Config, bucket, keyPrefix: prefix, } = await resolveS3ConfigAndInput(amplify, options);\n    // @ts-expect-error pageSize and nextToken should not coexist with listAll\n    if (options?.listAll && (options?.pageSize || options?.nextToken)) {\n        const anyOptions = options;\n        logger.debug(`listAll is set to true, ignoring ${anyOptions?.pageSize ? `pageSize: ${anyOptions?.pageSize}` : ''} ${anyOptions?.nextToken ? `nextToken: ${anyOptions?.nextToken}` : ''}.`);\n    }\n    const listParams = {\n        Bucket: bucket,\n        Prefix: `${prefix}${path}`,\n        MaxKeys: options?.listAll ? undefined : options?.pageSize,\n        ContinuationToken: options?.listAll ? undefined : options?.nextToken,\n    };\n    logger.debug(`listing items from \"${listParams.Prefix}\"`);\n    return options.listAll\n        ? _listAll({ s3Config, listParams, prefix })\n        : _list({ s3Config, listParams, prefix });\n};\nconst _listAll = async ({ s3Config, listParams, prefix, }) => {\n    const listResult = [];\n    let continuationToken = listParams.ContinuationToken;\n    do {\n        const { items: pageResults, nextToken: pageNextToken } = await _list({\n            prefix,\n            s3Config,\n            listParams: {\n                ...listParams,\n                ContinuationToken: continuationToken,\n                MaxKeys: MAX_PAGE_SIZE,\n            },\n        });\n        listResult.push(...pageResults);\n        continuationToken = pageNextToken;\n    } while (continuationToken);\n    return {\n        items: listResult,\n    };\n};\nconst _list = async ({ s3Config, listParams, prefix, }) => {\n    const listParamsClone = { ...listParams };\n    if (!listParamsClone.MaxKeys || listParamsClone.MaxKeys > MAX_PAGE_SIZE) {\n        logger.debug(`defaulting pageSize to ${MAX_PAGE_SIZE}.`);\n        listParamsClone.MaxKeys = MAX_PAGE_SIZE;\n    }\n    const response = await listObjectsV2({\n        ...s3Config,\n        userAgentValue: getStorageUserAgentValue(StorageAction.List),\n    }, listParamsClone);\n    if (!response?.Contents) {\n        return {\n            items: [],\n        };\n    }\n    const listResult = response.Contents.map(item => ({\n        key: item.Key.substring(prefix.length),\n        eTag: item.ETag,\n        lastModified: item.LastModified,\n        size: item.Size,\n    }));\n    return {\n        items: listResult,\n        nextToken: response.NextContinuationToken,\n    };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}