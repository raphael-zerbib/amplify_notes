{"ast":null,"code":"import { StorageAction } from '@aws-amplify/core/internals/utils';\nimport '@smithy/md5-js';\nimport '@aws-amplify/core/internals/aws-client-utils';\nimport '../../utils/client/runtime/s3TransferHandler/fetch.mjs';\nimport 'fast-xml-parser';\nimport '../../utils/client/runtime/s3TransferHandler/xhr.mjs';\nimport 'buffer';\nimport { resolveS3ConfigAndInput } from '../../utils/resolveS3ConfigAndInput.mjs';\nimport { assertValidationError } from '../../../../errors/utils/assertValidationError.mjs';\nimport { StorageValidationErrorCode } from '../../../../errors/types/validation.mjs';\nimport { logger } from '../../../../utils/logger.mjs';\nimport '../../utils/client/base.mjs';\nimport '../../utils/client/getObject.mjs';\nimport '../../utils/client/listObjectsV2.mjs';\nimport '../../utils/client/putObject.mjs';\nimport '../../utils/client/createMultipartUpload.mjs';\nimport '../../utils/client/uploadPart.mjs';\nimport '../../utils/client/completeMultipartUpload.mjs';\nimport '../../utils/client/listParts.mjs';\nimport '../../utils/client/abortMultipartUpload.mjs';\nimport { copyObject } from '../../utils/client/copyObject.mjs';\nimport '../../utils/client/headObject.mjs';\nimport '../../utils/client/deleteObject.mjs';\nimport { getStorageUserAgentValue } from '../../utils/userAgent.mjs';\n\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nconst copy = async (amplify, input) => {\n  const {\n    source: {\n      key: sourceKey\n    },\n    destination: {\n      key: destinationKey\n    }\n  } = input;\n  assertValidationError(!!sourceKey, StorageValidationErrorCode.NoSourceKey);\n  assertValidationError(!!destinationKey, StorageValidationErrorCode.NoDestinationKey);\n  const {\n    s3Config,\n    bucket,\n    keyPrefix: sourceKeyPrefix\n  } = await resolveS3ConfigAndInput(amplify, input.source);\n  const {\n    keyPrefix: destinationKeyPrefix\n  } = await resolveS3ConfigAndInput(amplify, input.destination); // resolveS3ConfigAndInput does not make extra API calls or storage access if called repeatedly.\n  // TODO(ashwinkumar6) V6-logger: warn `You may copy files from another user if the source level is \"protected\", currently it's ${srcLevel}`\n  const finalCopySource = \"\".concat(bucket, \"/\").concat(sourceKeyPrefix).concat(sourceKey);\n  const finalCopyDestination = \"\".concat(destinationKeyPrefix).concat(destinationKey);\n  logger.debug(\"copying \\\"\".concat(finalCopySource, \"\\\" to \\\"\").concat(finalCopyDestination, \"\\\".\"));\n  await copyObject({\n    ...s3Config,\n    userAgentValue: getStorageUserAgentValue(StorageAction.Copy)\n  }, {\n    Bucket: bucket,\n    CopySource: finalCopySource,\n    Key: finalCopyDestination,\n    MetadataDirective: 'COPY' // Copies over metadata like contentType as well\n  });\n  return {\n    key: destinationKey\n  };\n};\nexport { copy };","map":{"version":3,"names":["copy","amplify","input","source","key","sourceKey","destination","destinationKey","assertValidationError","StorageValidationErrorCode","NoSourceKey","NoDestinationKey","s3Config","bucket","keyPrefix","sourceKeyPrefix","resolveS3ConfigAndInput","destinationKeyPrefix","finalCopySource","concat","finalCopyDestination","logger","debug","copyObject","userAgentValue","getStorageUserAgentValue","StorageAction","Copy","Bucket","CopySource","Key","MetadataDirective"],"sources":["/Users/raphaperso/Documents/Hub/amplify_test/notes/node_modules/@aws-amplify/storage/src/providers/s3/apis/internal/copy.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { StorageAction } from '@aws-amplify/core/internals/utils';\nimport { resolveS3ConfigAndInput } from '../../utils';\nimport { StorageValidationErrorCode } from '../../../../errors/types/validation';\nimport { assertValidationError } from '../../../../errors/utils/assertValidationError';\nimport { copyObject } from '../../utils/client';\nimport { getStorageUserAgentValue } from '../../utils/userAgent';\nimport { logger } from '../../../../utils';\nexport const copy = async (amplify, input) => {\n    const { source: { key: sourceKey }, destination: { key: destinationKey }, } = input;\n    assertValidationError(!!sourceKey, StorageValidationErrorCode.NoSourceKey);\n    assertValidationError(!!destinationKey, StorageValidationErrorCode.NoDestinationKey);\n    const { s3Config, bucket, keyPrefix: sourceKeyPrefix, } = await resolveS3ConfigAndInput(amplify, input.source);\n    const { keyPrefix: destinationKeyPrefix } = await resolveS3ConfigAndInput(amplify, input.destination); // resolveS3ConfigAndInput does not make extra API calls or storage access if called repeatedly.\n    // TODO(ashwinkumar6) V6-logger: warn `You may copy files from another user if the source level is \"protected\", currently it's ${srcLevel}`\n    const finalCopySource = `${bucket}/${sourceKeyPrefix}${sourceKey}`;\n    const finalCopyDestination = `${destinationKeyPrefix}${destinationKey}`;\n    logger.debug(`copying \"${finalCopySource}\" to \"${finalCopyDestination}\".`);\n    await copyObject({\n        ...s3Config,\n        userAgentValue: getStorageUserAgentValue(StorageAction.Copy),\n    }, {\n        Bucket: bucket,\n        CopySource: finalCopySource,\n        Key: finalCopyDestination,\n        MetadataDirective: 'COPY', // Copies over metadata like contentType as well\n    });\n    return {\n        key: destinationKey,\n    };\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAQY,MAACA,IAAI,GAAG,MAAAA,CAAOC,OAAO,EAAEC,KAAK,KAAK;EAC1C,MAAM;IAAEC,MAAM,EAAE;MAAEC,GAAG,EAAEC;IAAS,CAAE;IAAEC,WAAW,EAAE;MAAEF,GAAG,EAAEG;IAAc;EAAE,CAAG,GAAGL,KAAK;EACnFM,qBAAqB,CAAC,CAAC,CAACH,SAAS,EAAEI,0BAA0B,CAACC,WAAW,CAAC;EAC1EF,qBAAqB,CAAC,CAAC,CAACD,cAAc,EAAEE,0BAA0B,CAACE,gBAAgB,CAAC;EACpF,MAAM;IAAEC,QAAQ;IAAEC,MAAM;IAAEC,SAAS,EAAEC;EAAe,CAAG,GAAG,MAAMC,uBAAuB,CAACf,OAAO,EAAEC,KAAK,CAACC,MAAM,CAAC;EAC9G,MAAM;IAAEW,SAAS,EAAEG;EAAoB,CAAE,GAAG,MAAMD,uBAAuB,CAACf,OAAO,EAAEC,KAAK,CAACI,WAAW,CAAC,CAAC;EAC1G;EACI,MAAMY,eAAe,MAAAC,MAAA,CAAMN,MAAM,OAAAM,MAAA,CAAIJ,eAAe,EAAAI,MAAA,CAAGd,SAAS,CAAE;EAClE,MAAMe,oBAAoB,MAAAD,MAAA,CAAMF,oBAAoB,EAAAE,MAAA,CAAGZ,cAAc,CAAE;EACvEc,MAAM,CAACC,KAAK,cAAAH,MAAA,CAAaD,eAAe,cAAAC,MAAA,CAASC,oBAAoB,QAAI,CAAC;EAC1E,MAAMG,UAAU,CAAC;IACb,GAAGX,QAAQ;IACXY,cAAc,EAAEC,wBAAwB,CAACC,aAAa,CAACC,IAAI;EACnE,CAAK,EAAE;IACCC,MAAM,EAAEf,MAAM;IACdgB,UAAU,EAAEX,eAAe;IAC3BY,GAAG,EAAEV,oBAAoB;IACzBW,iBAAiB,EAAE,MAAM;EACjC,CAAK,CAAC;EACF,OAAO;IACH3B,GAAG,EAAEG;EACb,CAAK;AACL","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}