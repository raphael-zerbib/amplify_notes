{"ast":null,"code":"import { Amplify } from 'aws-amplify';\nimport { getCurrentUser, signIn, signUp, confirmSignIn, confirmSignUp, confirmResetPassword, resetPassword } from 'aws-amplify/auth';\nimport 'aws-amplify/utils';\nimport '@aws-amplify/core/internals/utils';\nimport '../../utils/setUserAgent/constants.mjs';\nimport '../../types/authenticator/user.mjs';\nimport '../../types/authenticator/attributes.mjs';\nimport { hasSpecialChars } from '../../helpers/authenticator/utils.mjs';\nimport '../../helpers/accountSettings/utils.mjs';\n\n// Cognito does not allow a password length less then 8 characters\nconst DEFAULT_COGNITO_PASSWORD_MIN_LENGTH = 8;\nconst isInvalidUserAtributes = userAttributes => Array.isArray(userAttributes);\nconst parseUserAttributes = userAttributes => {\n  if (!userAttributes) {\n    return undefined;\n  }\n  // `aws-amplify` versions <= 6.0.5 return an array of `userAttributes` rather than an object\n  if (isInvalidUserAtributes(userAttributes)) {\n    return Object.entries(userAttributes).map(_ref => {\n      let [_, value] = _ref;\n      return Object.keys(value)[0];\n    });\n  }\n  return Object.keys(userAttributes);\n};\nconst defaultServices = {\n  async getAmplifyConfig() {\n    var _result$Auth, _result$Auth$Cognito, _result$Auth2, _loginWith$oauth, _loginWith$oauth$prov;\n    const result = Amplify.getConfig();\n    const cliConfig = (_result$Auth = result.Auth) === null || _result$Auth === void 0 ? void 0 : _result$Auth.Cognito;\n    const {\n      loginWith,\n      userAttributes\n    } = (_result$Auth$Cognito = (_result$Auth2 = result.Auth) === null || _result$Auth2 === void 0 ? void 0 : _result$Auth2.Cognito) !== null && _result$Auth$Cognito !== void 0 ? _result$Auth$Cognito : {};\n    const parsedLoginMechanisms = loginWith ? Object.entries(loginWith).filter(_ref2 => {\n      let [key, _value] = _ref2;\n      return key !== 'oauth';\n    }).filter(_ref3 => {\n      let [_key, value] = _ref3;\n      return !!value;\n    }).map(keyValueArray => {\n      return keyValueArray[0] === 'phone' // the key for phone_number is phone in getConfig but everywhere else we treat is as phone_number\n      ? 'phone_number' : keyValueArray[0];\n    }) : undefined;\n    const parsedSignupAttributes = parseUserAttributes(userAttributes);\n    const parsedSocialProviders = loginWith !== null && loginWith !== void 0 && (_loginWith$oauth = loginWith.oauth) !== null && _loginWith$oauth !== void 0 && _loginWith$oauth.providers ? (_loginWith$oauth$prov = loginWith.oauth.providers) === null || _loginWith$oauth$prov === void 0 ? void 0 : _loginWith$oauth$prov.map(provider => provider.toString().toLowerCase()) : undefined;\n    return {\n      ...cliConfig,\n      loginMechanisms: parsedLoginMechanisms,\n      signUpAttributes: parsedSignupAttributes,\n      socialProviders: parsedSocialProviders\n    };\n  },\n  getCurrentUser,\n  handleSignIn: signIn,\n  handleSignUp: signUp,\n  handleConfirmSignIn: confirmSignIn,\n  handleConfirmSignUp: confirmSignUp,\n  handleForgotPasswordSubmit: confirmResetPassword,\n  handleForgotPassword: resetPassword,\n  // Validation hooks for overriding\n  async validateCustomSignUp(formData, touchData) {},\n  async validateFormPassword(formData, touchData, passwordSettings) {\n    var _passwordSettings$min;\n    const {\n      password\n    } = formData;\n    const {\n      password: touched_password\n    } = touchData;\n    /**\n     * If the password is not touched,\n     * or if the password settings are not set, we don't need to validate it.\n     */\n    if (!touched_password || !passwordSettings) return null;\n    const password_complexity = [];\n    const policyMinLength = (_passwordSettings$min = passwordSettings.minLength) !== null && _passwordSettings$min !== void 0 ? _passwordSettings$min : DEFAULT_COGNITO_PASSWORD_MIN_LENGTH;\n    if (password.length < policyMinLength) {\n      password_complexity.push(\"Password must have at least \".concat(policyMinLength, \" characters\"));\n    }\n    if (passwordSettings.requireLowercase && !/[a-z]/.test(password)) password_complexity.push('Password must have lower case letters');\n    if (passwordSettings.requireUppercase && !/[A-Z]/.test(password)) password_complexity.push('Password must have upper case letters');\n    if (passwordSettings.requireNumbers && !/[0-9]/.test(password)) password_complexity.push('Password must have numbers');\n    // https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-policies.html\n    if (passwordSettings.requireSpecialCharacters && !hasSpecialChars(password)) password_complexity.push('Password must have special characters');\n    /**\n     * Only return an error if there is at least one error.\n     */\n    return password_complexity.length !== 0 ? {\n      password: password_complexity\n    } : null;\n  },\n  async validateConfirmPassword(formData, touchData) {\n    const {\n      password,\n      confirm_password\n    } = formData;\n    const {\n      confirm_password: touched_confirm_password,\n      password: touched_password\n    } = touchData;\n    if (!password && !confirm_password) {\n      // these inputs are clean, don't complain yet\n      return null;\n    } else if ((password || confirm_password) && password !== confirm_password && (touched_confirm_password && touched_password || (password === null || password === void 0 ? void 0 : password.length) >= 6 && (confirm_password === null || confirm_password === void 0 ? void 0 : confirm_password.length) >= 6)) {\n      // Only return an error if both fields have text entered,\n      // the passwords do not match, and the fields have been\n      // touched or the password and confirm password is longer then or equal to 6.\n      return {\n        confirm_password: 'Your passwords must match'\n      };\n    }\n  },\n  async validatePreferredUsername(formData, touchData) {}\n};\nexport { defaultServices };","map":{"version":3,"names":["Amplify","getCurrentUser","signIn","signUp","confirmSignIn","confirmSignUp","confirmResetPassword","resetPassword","hasSpecialChars","DEFAULT_COGNITO_PASSWORD_MIN_LENGTH","isInvalidUserAtributes","userAttributes","Array","isArray","parseUserAttributes","undefined","Object","entries","map","_ref","_","value","keys","defaultServices","getAmplifyConfig","_result$Auth","_result$Auth$Cognito","_result$Auth2","_loginWith$oauth","_loginWith$oauth$prov","result","getConfig","cliConfig","Auth","Cognito","loginWith","parsedLoginMechanisms","filter","_ref2","key","_value","_ref3","_key","keyValueArray","parsedSignupAttributes","parsedSocialProviders","oauth","providers","provider","toString","toLowerCase","loginMechanisms","signUpAttributes","socialProviders","handleSignIn","handleSignUp","handleConfirmSignIn","handleConfirmSignUp","handleForgotPasswordSubmit","handleForgotPassword","validateCustomSignUp","formData","touchData","validateFormPassword","passwordSettings","_passwordSettings$min","password","touched_password","password_complexity","policyMinLength","minLength","length","push","concat","requireLowercase","test","requireUppercase","requireNumbers","requireSpecialCharacters","validateConfirmPassword","confirm_password","touched_confirm_password","validatePreferredUsername"],"sources":["/Users/raphaperso/Documents/Hub/amplify_test/notes/node_modules/@aws-amplify/ui/dist/esm/machines/authenticator/defaultServices.mjs"],"sourcesContent":["import { Amplify } from 'aws-amplify';\nimport { getCurrentUser, signIn, signUp, confirmSignIn, confirmSignUp, confirmResetPassword, resetPassword } from 'aws-amplify/auth';\nimport 'aws-amplify/utils';\nimport '@aws-amplify/core/internals/utils';\nimport '../../utils/setUserAgent/constants.mjs';\nimport '../../types/authenticator/user.mjs';\nimport '../../types/authenticator/attributes.mjs';\nimport { hasSpecialChars } from '../../helpers/authenticator/utils.mjs';\nimport '../../helpers/accountSettings/utils.mjs';\n\n// Cognito does not allow a password length less then 8 characters\nconst DEFAULT_COGNITO_PASSWORD_MIN_LENGTH = 8;\nconst isInvalidUserAtributes = (userAttributes) => Array.isArray(userAttributes);\nconst parseUserAttributes = (userAttributes) => {\n    if (!userAttributes) {\n        return undefined;\n    }\n    // `aws-amplify` versions <= 6.0.5 return an array of `userAttributes` rather than an object\n    if (isInvalidUserAtributes(userAttributes)) {\n        return Object.entries(userAttributes).map(([_, value]) => Object.keys(value)[0]);\n    }\n    return Object.keys(userAttributes);\n};\nconst defaultServices = {\n    async getAmplifyConfig() {\n        const result = Amplify.getConfig();\n        const cliConfig = result.Auth?.Cognito;\n        const { loginWith, userAttributes } = result.Auth?.Cognito ?? {};\n        const parsedLoginMechanisms = loginWith\n            ? Object.entries(loginWith)\n                .filter(([key, _value]) => key !== 'oauth')\n                .filter(([_key, value]) => !!value)\n                .map((keyValueArray) => {\n                return keyValueArray[0] === 'phone' // the key for phone_number is phone in getConfig but everywhere else we treat is as phone_number\n                    ? 'phone_number'\n                    : keyValueArray[0];\n            })\n            : undefined;\n        const parsedSignupAttributes = parseUserAttributes(userAttributes);\n        const parsedSocialProviders = loginWith?.oauth?.providers\n            ? loginWith.oauth.providers?.map((provider) => provider.toString().toLowerCase())\n            : undefined;\n        return {\n            ...cliConfig,\n            loginMechanisms: parsedLoginMechanisms,\n            signUpAttributes: parsedSignupAttributes,\n            socialProviders: parsedSocialProviders,\n        };\n    },\n    getCurrentUser,\n    handleSignIn: signIn,\n    handleSignUp: signUp,\n    handleConfirmSignIn: confirmSignIn,\n    handleConfirmSignUp: confirmSignUp,\n    handleForgotPasswordSubmit: confirmResetPassword,\n    handleForgotPassword: resetPassword,\n    // Validation hooks for overriding\n    async validateCustomSignUp(formData, touchData) { },\n    async validateFormPassword(formData, touchData, passwordSettings) {\n        const { password } = formData;\n        const { password: touched_password } = touchData;\n        /**\n         * If the password is not touched,\n         * or if the password settings are not set, we don't need to validate it.\n         */\n        if (!touched_password || !passwordSettings)\n            return null;\n        const password_complexity = [];\n        const policyMinLength = passwordSettings.minLength ?? DEFAULT_COGNITO_PASSWORD_MIN_LENGTH;\n        if (password.length < policyMinLength) {\n            password_complexity.push(`Password must have at least ${policyMinLength} characters`);\n        }\n        if (passwordSettings.requireLowercase && !/[a-z]/.test(password))\n            password_complexity.push('Password must have lower case letters');\n        if (passwordSettings.requireUppercase && !/[A-Z]/.test(password))\n            password_complexity.push('Password must have upper case letters');\n        if (passwordSettings.requireNumbers && !/[0-9]/.test(password))\n            password_complexity.push('Password must have numbers');\n        // https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-policies.html\n        if (passwordSettings.requireSpecialCharacters && !hasSpecialChars(password))\n            password_complexity.push('Password must have special characters');\n        /**\n         * Only return an error if there is at least one error.\n         */\n        return password_complexity.length !== 0\n            ? { password: password_complexity }\n            : null;\n    },\n    async validateConfirmPassword(formData, touchData) {\n        const { password, confirm_password } = formData;\n        const { confirm_password: touched_confirm_password, password: touched_password, } = touchData;\n        if (!password && !confirm_password) {\n            // these inputs are clean, don't complain yet\n            return null;\n        }\n        else if ((password || confirm_password) &&\n            password !== confirm_password &&\n            ((touched_confirm_password && touched_password) ||\n                (password?.length >= 6 && confirm_password?.length >= 6))) {\n            // Only return an error if both fields have text entered,\n            // the passwords do not match, and the fields have been\n            // touched or the password and confirm password is longer then or equal to 6.\n            return {\n                confirm_password: 'Your passwords must match',\n            };\n        }\n    },\n    async validatePreferredUsername(formData, touchData) { },\n};\n\nexport { defaultServices };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}