{"ast":null,"code":"import React__default, { useContext, useMemo, useEffect } from 'react';\nimport { useInterpret } from '@xstate/react';\nimport { getCurrentUser } from 'aws-amplify/auth';\nimport { createAuthenticatorMachine, listenToAuthHub, defaultAuthHubHandler } from '@aws-amplify/ui';\nimport { AuthenticatorContext } from './AuthenticatorContext.mjs';\nconst createHubHandler = options => (data, service) => {\n  defaultAuthHubHandler(data, service, options);\n};\nfunction AuthenticatorProvider(_ref) {\n  let {\n    children\n  } = _ref;\n  // `authStatus` is exposed by `useAuthenticator` but should not be derived directly from the\n  // state machine as the machine only updates on `Authenticator` initiated events, which\n  // leads to scenarios where the state machine `authStatus` gets \"stuck\". For exmample,\n  // if a user was to sign in using `Auth.signIn` directly rather than using `Authenticator`\n  const [authStatus, setAuthStatus] = React__default.useState('configuring');\n  // only run on first render\n  React__default.useEffect(() => {\n    getCurrentUser().then(() => {\n      setAuthStatus('authenticated');\n    }).catch(() => {\n      setAuthStatus('unauthenticated');\n    });\n  }, []);\n  /**\n   * Based on use cases, developer might already have added another Provider\n   * outside Authenticator. In that case, we sync the two providers by just\n   * passing the parent value.\n   *\n   * TODO(BREAKING): enforce only one provider in App tree\n   */\n  const parentProviderVal = useContext(AuthenticatorContext);\n  const service = useInterpret(createAuthenticatorMachine);\n  const value = useMemo(() => !parentProviderVal ? {\n    authStatus,\n    service\n  } : parentProviderVal, [authStatus, parentProviderVal, service]);\n  const {\n    service: activeService\n  } = value;\n  useEffect(() => {\n    const onSignIn = () => {\n      setAuthStatus('authenticated');\n    };\n    const onSignOut = () => {\n      setAuthStatus('unauthenticated');\n    };\n    const unsubscribe = listenToAuthHub(activeService, createHubHandler({\n      onSignIn,\n      onSignOut\n    }));\n    return unsubscribe;\n  }, [activeService]);\n  return React__default.createElement(AuthenticatorContext.Provider, {\n    value: value\n  }, children);\n}\nexport { AuthenticatorProvider as default };","map":{"version":3,"names":["React__default","useContext","useMemo","useEffect","useInterpret","getCurrentUser","createAuthenticatorMachine","listenToAuthHub","defaultAuthHubHandler","AuthenticatorContext","createHubHandler","options","data","service","AuthenticatorProvider","_ref","children","authStatus","setAuthStatus","useState","then","catch","parentProviderVal","value","activeService","onSignIn","onSignOut","unsubscribe","createElement","Provider","default"],"sources":["/Users/raphaperso/Documents/Hub/amplify_test/notes/node_modules/@aws-amplify/ui-react-core/dist/esm/Authenticator/context/AuthenticatorProvider.mjs"],"sourcesContent":["import React__default, { useContext, useMemo, useEffect } from 'react';\nimport { useInterpret } from '@xstate/react';\nimport { getCurrentUser } from 'aws-amplify/auth';\nimport { createAuthenticatorMachine, listenToAuthHub, defaultAuthHubHandler } from '@aws-amplify/ui';\nimport { AuthenticatorContext } from './AuthenticatorContext.mjs';\n\nconst createHubHandler = (options) => (data, service) => {\n    defaultAuthHubHandler(data, service, options);\n};\nfunction AuthenticatorProvider({ children, }) {\n    // `authStatus` is exposed by `useAuthenticator` but should not be derived directly from the\n    // state machine as the machine only updates on `Authenticator` initiated events, which\n    // leads to scenarios where the state machine `authStatus` gets \"stuck\". For exmample,\n    // if a user was to sign in using `Auth.signIn` directly rather than using `Authenticator`\n    const [authStatus, setAuthStatus] = React__default.useState('configuring');\n    // only run on first render\n    React__default.useEffect(() => {\n        getCurrentUser()\n            .then(() => {\n            setAuthStatus('authenticated');\n        })\n            .catch(() => {\n            setAuthStatus('unauthenticated');\n        });\n    }, []);\n    /**\n     * Based on use cases, developer might already have added another Provider\n     * outside Authenticator. In that case, we sync the two providers by just\n     * passing the parent value.\n     *\n     * TODO(BREAKING): enforce only one provider in App tree\n     */\n    const parentProviderVal = useContext(AuthenticatorContext);\n    const service = useInterpret(createAuthenticatorMachine);\n    const value = useMemo(() => (!parentProviderVal ? { authStatus, service } : parentProviderVal), [authStatus, parentProviderVal, service]);\n    const { service: activeService } = value;\n    useEffect(() => {\n        const onSignIn = () => {\n            setAuthStatus('authenticated');\n        };\n        const onSignOut = () => {\n            setAuthStatus('unauthenticated');\n        };\n        const unsubscribe = listenToAuthHub(activeService, createHubHandler({ onSignIn, onSignOut }));\n        return unsubscribe;\n    }, [activeService]);\n    return (React__default.createElement(AuthenticatorContext.Provider, { value: value }, children));\n}\n\nexport { AuthenticatorProvider as default };\n"],"mappings":"AAAA,OAAOA,cAAc,IAAIC,UAAU,EAAEC,OAAO,EAAEC,SAAS,QAAQ,OAAO;AACtE,SAASC,YAAY,QAAQ,eAAe;AAC5C,SAASC,cAAc,QAAQ,kBAAkB;AACjD,SAASC,0BAA0B,EAAEC,eAAe,EAAEC,qBAAqB,QAAQ,iBAAiB;AACpG,SAASC,oBAAoB,QAAQ,4BAA4B;AAEjE,MAAMC,gBAAgB,GAAIC,OAAO,IAAK,CAACC,IAAI,EAAEC,OAAO,KAAK;EACrDL,qBAAqB,CAACI,IAAI,EAAEC,OAAO,EAAEF,OAAO,CAAC;AACjD,CAAC;AACD,SAASG,qBAAqBA,CAAAC,IAAA,EAAgB;EAAA,IAAf;IAAEC;EAAU,CAAC,GAAAD,IAAA;EACxC;EACA;EACA;EACA;EACA,MAAM,CAACE,UAAU,EAAEC,aAAa,CAAC,GAAGlB,cAAc,CAACmB,QAAQ,CAAC,aAAa,CAAC;EAC1E;EACAnB,cAAc,CAACG,SAAS,CAAC,MAAM;IAC3BE,cAAc,CAAC,CAAC,CACXe,IAAI,CAAC,MAAM;MACZF,aAAa,CAAC,eAAe,CAAC;IAClC,CAAC,CAAC,CACGG,KAAK,CAAC,MAAM;MACbH,aAAa,CAAC,iBAAiB,CAAC;IACpC,CAAC,CAAC;EACN,CAAC,EAAE,EAAE,CAAC;EACN;AACJ;AACA;AACA;AACA;AACA;AACA;EACI,MAAMI,iBAAiB,GAAGrB,UAAU,CAACQ,oBAAoB,CAAC;EAC1D,MAAMI,OAAO,GAAGT,YAAY,CAACE,0BAA0B,CAAC;EACxD,MAAMiB,KAAK,GAAGrB,OAAO,CAAC,MAAO,CAACoB,iBAAiB,GAAG;IAAEL,UAAU;IAAEJ;EAAQ,CAAC,GAAGS,iBAAkB,EAAE,CAACL,UAAU,EAAEK,iBAAiB,EAAET,OAAO,CAAC,CAAC;EACzI,MAAM;IAAEA,OAAO,EAAEW;EAAc,CAAC,GAAGD,KAAK;EACxCpB,SAAS,CAAC,MAAM;IACZ,MAAMsB,QAAQ,GAAGA,CAAA,KAAM;MACnBP,aAAa,CAAC,eAAe,CAAC;IAClC,CAAC;IACD,MAAMQ,SAAS,GAAGA,CAAA,KAAM;MACpBR,aAAa,CAAC,iBAAiB,CAAC;IACpC,CAAC;IACD,MAAMS,WAAW,GAAGpB,eAAe,CAACiB,aAAa,EAAEd,gBAAgB,CAAC;MAAEe,QAAQ;MAAEC;IAAU,CAAC,CAAC,CAAC;IAC7F,OAAOC,WAAW;EACtB,CAAC,EAAE,CAACH,aAAa,CAAC,CAAC;EACnB,OAAQxB,cAAc,CAAC4B,aAAa,CAACnB,oBAAoB,CAACoB,QAAQ,EAAE;IAAEN,KAAK,EAAEA;EAAM,CAAC,EAAEP,QAAQ,CAAC;AACnG;AAEA,SAASF,qBAAqB,IAAIgB,OAAO","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}