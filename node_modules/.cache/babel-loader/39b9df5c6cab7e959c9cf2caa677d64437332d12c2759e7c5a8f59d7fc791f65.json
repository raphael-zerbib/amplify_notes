{"ast":null,"code":"import QRCode from 'qrcode';\nimport * as React from 'react';\nimport { ConsoleLogger } from 'aws-amplify/utils';\nimport { authenticatorTextUtil, getTotpCodeURL } from '@aws-amplify/ui';\nimport { Flex } from '../../../primitives/Flex/Flex.mjs';\nimport { Heading } from '../../../primitives/Heading/Heading.mjs';\nimport { useAuthenticator } from '@aws-amplify/ui-react-core';\nimport { useCustomComponents } from '../hooks/useCustomComponents/useCustomComponents.mjs';\nimport { useFormHandlers } from '../hooks/useFormHandlers/useFormHandlers.mjs';\nimport { ConfirmSignInFooter } from '../shared/ConfirmSignInFooter.mjs';\nimport { RemoteErrorMessage } from '../shared/RemoteErrorMessage.mjs';\nimport { FormFields } from '../shared/FormFields.mjs';\nimport { RouteContainer } from '../RouteContainer/RouteContainer.mjs';\nconst logger = new ConsoleLogger('SetupTotp-logger');\nconst {\n  getSetupTotpText,\n  getCopiedText,\n  getLoadingText\n} = authenticatorTextUtil;\nconst SetupTotp = _ref => {\n  let {\n    className,\n    variation\n  } = _ref;\n  const {\n    totpSecretCode,\n    isPending,\n    username,\n    QRFields\n  } = useAuthenticator(context => [context.isPending, context.totpSecretCode, context.username]);\n  const {\n    handleChange,\n    handleSubmit\n  } = useFormHandlers();\n  const {\n    components: {\n      // @ts-ignore\n      SetupTotp: {\n        Header = SetupTotp.Header,\n        Footer = SetupTotp.Footer\n      }\n    }\n  } = useCustomComponents();\n  const [isLoading, setIsLoading] = React.useState(true);\n  const [qrCode, setQrCode] = React.useState();\n  const [copyTextLabel, setCopyTextLabel] = React.useState('COPY');\n  const {\n    totpIssuer = 'AWSCognito',\n    totpUsername = username\n  } = QRFields !== null && QRFields !== void 0 ? QRFields : {};\n  const generateQRCode = React.useCallback(async () => {\n    try {\n      const totpCode = getTotpCodeURL(totpIssuer, totpUsername, totpSecretCode);\n      const qrCodeImageSource = await QRCode.toDataURL(totpCode);\n      setQrCode(qrCodeImageSource);\n    } catch (error) {\n      logger.error(error);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [totpIssuer, totpUsername, totpSecretCode]);\n  React.useEffect(() => {\n    if (!qrCode) {\n      generateQRCode();\n    }\n  }, [generateQRCode, qrCode]);\n  const copyText = () => {\n    navigator.clipboard.writeText(totpSecretCode);\n    setCopyTextLabel(getCopiedText());\n  };\n  return React.createElement(RouteContainer, {\n    className: className,\n    variation: variation\n  }, React.createElement(\"form\", {\n    \"data-amplify-form\": \"\",\n    \"data-amplify-authenticator-setup-totp\": \"\",\n    method: \"post\",\n    onChange: handleChange,\n    onSubmit: handleSubmit\n  }, React.createElement(Flex, {\n    as: \"fieldset\",\n    direction: \"column\",\n    isDisabled: isPending\n  }, React.createElement(Header, null), React.createElement(Flex, {\n    direction: \"column\"\n  }, isLoading ? React.createElement(\"p\", null, getLoadingText(), \"\\u2026\") : React.createElement(\"img\", {\n    \"data-amplify-qrcode\": true,\n    src: qrCode,\n    alt: \"qr code\",\n    width: \"228\",\n    height: \"228\"\n  }), React.createElement(Flex, {\n    \"data-amplify-copy\": true\n  }, React.createElement(\"div\", null, totpSecretCode), React.createElement(Flex, {\n    \"data-amplify-copy-svg\": true,\n    onClick: copyText\n  }, React.createElement(\"div\", {\n    \"data-amplify-copy-tooltip\": true\n  }, copyTextLabel), React.createElement(\"svg\", {\n    width: \"24\",\n    height: \"24\",\n    viewBox: \"0 0 24 24\",\n    xmlns: \"http://www.w3.org/2000/svg\"\n  }, React.createElement(\"path\", {\n    d: \"M16 1H4C2.9 1 2 1.9 2 3V17H4V3H16V1ZM15 5H8C6.9 5 6.01 5.9 6.01 7L6 21C6 22.1 6.89 23 7.99 23H19C20.1 23 21 22.1 21 21V11L15 5ZM8 21V7H14V12H19V21H8Z\"\n  })))), React.createElement(FormFields, null), React.createElement(RemoteErrorMessage, null)), React.createElement(ConfirmSignInFooter, null), React.createElement(Footer, null))));\n};\nSetupTotp.Header = function Header() {\n  return React.createElement(Heading, {\n    level: 3\n  }, getSetupTotpText());\n};\nSetupTotp.Footer = function Footer() {\n  // @ts-ignore\n  return null;\n};\nexport { SetupTotp };","map":{"version":3,"names":["QRCode","React","ConsoleLogger","authenticatorTextUtil","getTotpCodeURL","Flex","Heading","useAuthenticator","useCustomComponents","useFormHandlers","ConfirmSignInFooter","RemoteErrorMessage","FormFields","RouteContainer","logger","getSetupTotpText","getCopiedText","getLoadingText","SetupTotp","_ref","className","variation","totpSecretCode","isPending","username","QRFields","context","handleChange","handleSubmit","components","Header","Footer","isLoading","setIsLoading","useState","qrCode","setQrCode","copyTextLabel","setCopyTextLabel","totpIssuer","totpUsername","generateQRCode","useCallback","totpCode","qrCodeImageSource","toDataURL","error","useEffect","copyText","navigator","clipboard","writeText","createElement","method","onChange","onSubmit","as","direction","isDisabled","src","alt","width","height","onClick","viewBox","xmlns","d","level"],"sources":["/Users/raphaperso/Documents/Hub/amplify_test/notes/node_modules/@aws-amplify/ui-react/dist/esm/components/Authenticator/SetupTotp/SetupTotp.mjs"],"sourcesContent":["import QRCode from 'qrcode';\nimport * as React from 'react';\nimport { ConsoleLogger } from 'aws-amplify/utils';\nimport { authenticatorTextUtil, getTotpCodeURL } from '@aws-amplify/ui';\nimport { Flex } from '../../../primitives/Flex/Flex.mjs';\nimport { Heading } from '../../../primitives/Heading/Heading.mjs';\nimport { useAuthenticator } from '@aws-amplify/ui-react-core';\nimport { useCustomComponents } from '../hooks/useCustomComponents/useCustomComponents.mjs';\nimport { useFormHandlers } from '../hooks/useFormHandlers/useFormHandlers.mjs';\nimport { ConfirmSignInFooter } from '../shared/ConfirmSignInFooter.mjs';\nimport { RemoteErrorMessage } from '../shared/RemoteErrorMessage.mjs';\nimport { FormFields } from '../shared/FormFields.mjs';\nimport { RouteContainer } from '../RouteContainer/RouteContainer.mjs';\n\nconst logger = new ConsoleLogger('SetupTotp-logger');\nconst { getSetupTotpText, getCopiedText, getLoadingText } = authenticatorTextUtil;\nconst SetupTotp = ({ className, variation, }) => {\n    const { totpSecretCode, isPending, username, QRFields } = useAuthenticator((context) => [context.isPending, context.totpSecretCode, context.username]);\n    const { handleChange, handleSubmit } = useFormHandlers();\n    const { components: { \n    // @ts-ignore\n    SetupTotp: { Header = SetupTotp.Header, Footer = SetupTotp.Footer }, }, } = useCustomComponents();\n    const [isLoading, setIsLoading] = React.useState(true);\n    const [qrCode, setQrCode] = React.useState();\n    const [copyTextLabel, setCopyTextLabel] = React.useState('COPY');\n    const { totpIssuer = 'AWSCognito', totpUsername = username } = QRFields ?? {};\n    const generateQRCode = React.useCallback(async () => {\n        try {\n            const totpCode = getTotpCodeURL(totpIssuer, totpUsername, totpSecretCode);\n            const qrCodeImageSource = await QRCode.toDataURL(totpCode);\n            setQrCode(qrCodeImageSource);\n        }\n        catch (error) {\n            logger.error(error);\n        }\n        finally {\n            setIsLoading(false);\n        }\n    }, [totpIssuer, totpUsername, totpSecretCode]);\n    React.useEffect(() => {\n        if (!qrCode) {\n            generateQRCode();\n        }\n    }, [generateQRCode, qrCode]);\n    const copyText = () => {\n        navigator.clipboard.writeText(totpSecretCode);\n        setCopyTextLabel(getCopiedText());\n    };\n    return (React.createElement(RouteContainer, { className: className, variation: variation },\n        React.createElement(\"form\", { \"data-amplify-form\": \"\", \"data-amplify-authenticator-setup-totp\": \"\", method: \"post\", onChange: handleChange, onSubmit: handleSubmit },\n            React.createElement(Flex, { as: \"fieldset\", direction: \"column\", isDisabled: isPending },\n                React.createElement(Header, null),\n                React.createElement(Flex, { direction: \"column\" },\n                    isLoading ? (React.createElement(\"p\", null,\n                        getLoadingText(),\n                        \"\\u2026\")) : (React.createElement(\"img\", { \"data-amplify-qrcode\": true, src: qrCode, alt: \"qr code\", width: \"228\", height: \"228\" })),\n                    React.createElement(Flex, { \"data-amplify-copy\": true },\n                        React.createElement(\"div\", null, totpSecretCode),\n                        React.createElement(Flex, { \"data-amplify-copy-svg\": true, onClick: copyText },\n                            React.createElement(\"div\", { \"data-amplify-copy-tooltip\": true }, copyTextLabel),\n                            React.createElement(\"svg\", { width: \"24\", height: \"24\", viewBox: \"0 0 24 24\", xmlns: \"http://www.w3.org/2000/svg\" },\n                                React.createElement(\"path\", { d: \"M16 1H4C2.9 1 2 1.9 2 3V17H4V3H16V1ZM15 5H8C6.9 5 6.01 5.9 6.01 7L6 21C6 22.1 6.89 23 7.99 23H19C20.1 23 21 22.1 21 21V11L15 5ZM8 21V7H14V12H19V21H8Z\" })))),\n                    React.createElement(FormFields, null),\n                    React.createElement(RemoteErrorMessage, null)),\n                React.createElement(ConfirmSignInFooter, null),\n                React.createElement(Footer, null)))));\n};\nSetupTotp.Header = function Header() {\n    return React.createElement(Heading, { level: 3 }, getSetupTotpText());\n};\nSetupTotp.Footer = function Footer() {\n    // @ts-ignore\n    return null;\n};\n\nexport { SetupTotp };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}